<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="test">
    <title>test</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <META HTTP-EQUIV="Refresh" Content="10.8473521, url=https://fluffyf1sh.github.io/str_bet">
    <script src="https://code.jquery.com/jquery-3.0.0.js"></script>
	<script src="https://code.jquery.com/jquery-migrate-3.1.0.js"></script>
</head>
<style type="text/css">
	.all{
	font-family: Impact, Charcoal, sans-serif; 
	font-size: 20pt;
	color: rgb(0,155,55);
}
</style>
<body class="all" id="upd">
	<script>var data = null;
	var xhr = new XMLHttpRequest();
	var all = document.createElement('div');
	document.body.appendChild(all);
	var title = document.createElement('div');
	var sum = document.createElement('div');
	var users = document.createElement('div');
	var opt1 = document.createElement('div');
	var opt2 = document.createElement('div');
	var arr;
	xhr.addEventListener("readystatechange", function () {
  	if (this.readyState === this.DONE){
	    title.textContent =  this.response;
		sum.textContent = this.response;
		users.textContent = this.response;
		opt1.textContent = this.response;
		opt2.textContent = this.response;
		arr = this.response.split(',');
		var act = `{"active":null`;
		var check1 = `"winner":true}`;
		var check2 = `"winner":true}]`;
		var winRes;
		if(act == arr[0]){
			if(check1 == arr[14]){
				winRes = arr[12];
				winRes = winRes.replace(`"title":`,``).replace(`"`,``).replace(`"`,``);
			}
			else if(check2 == arr[19]){
				winRes = arr[17];
				winRes = winRes.replace('"title":', '').replace('"','').replace('"','');
			}
			else if(check1 !== arr[14] && check2 !== arr[19]){
				winRes = "нет";
			}
			title.textContent = ' ';
			sum.textContent = 'Соревнование не проводится. ';
			users.textContent = 'Прошлый победитель: ' + winRes + '!';
			opt1.textContent = ' ';
			opt2.textContent = ' ';
			}
			else{
				sum.textContent = (arr[1].replace('"totalAmount"',"Общая сумма"));
				title.textContent = (arr[4].replace('"title":',"").replace('"', '').replace('"', ""));
				users.textContent = (arr[2].replace('"totalUsers"',"Ставочников"));
				opt1.textContent = ("!bet " + arr[12].replace('"command":', "").replace('"', '').replace('"}', "") + " [сумма]");
				opt2.textContent = ("!bet " + arr[17].replace('"command":', "").replace('"', '').replace('"}]', "") + " [сумма]");;
			}
					
	}
	else if(this.readyState != this.readyState){
		console.log(this.response);
	}
	all.appendChild(title); 
	all.appendChild(sum);
	all.appendChild(users);
	all.appendChild(opt1);
	all.appendChild(opt2);
});
xhr.open("GET", "https://api.streamelements.com/kappa/v2/contests/5d26328e6b84c45a4fe1845a");
xhr.setRequestHeader("accept", "application/json");
xhr.send(data);</script>
</body>